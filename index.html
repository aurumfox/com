<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AlphaFox DAO - Final Stable</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>
    <script>window.Buffer = window.buffer.Buffer;</script>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>

    <style>
        body { background: #0b0d11; color: white; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: #161a1e; border: 1px solid #2b3139; border-radius: 16px; padding: 30px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn { background: #f0b90b; color: #000; border: none; padding: 15px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; transition: 0.3s; }
        .btn:hover { background: #ffe066; }
        .btn:disabled { background: #474d57; color: #848e9c; cursor: not-allowed; }
        #wallet-info { margin-top: 20px; font-family: monospace; color: #848e9c; word-break: break-all; font-size: 12px; }
        .status { margin-bottom: 15px; font-size: 14px; }
        .online { color: #0ecb81; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="color:#f0b90b">AlphaFox Terminal</h2>
    <div class="status" id="status">Status: <span style="color: #ff4d4d;">Disconnected</span></div>
    
    <button id="connect-btn" class="btn">Connect Phantom</button>
    
    <div id="wallet-info"></div>

    <div id="staking-ui" style="display:none; margin-top: 20px; border-top: 1px solid #2b3139; padding-top: 20px;">
        <input type="number" id="amt" placeholder="Amount" style="width:80%; padding:10px; margin-bottom:10px; border-radius:5px; border:none;">
        <button class="btn" onclick="alert('Staking logic triggers now!')">Stake AFOX</button>
    </div>
</div>

<script>
// Ждем полной загрузки DOM
document.addEventListener('DOMContentLoaded', () => {
    
    const connectBtn = document.getElementById('connect-btn');
    const statusEl = document.getElementById('status');
    const walletInfo = document.getElementById('wallet-info');
    const stakingUi = document.getElementById('staking-ui');

    // Функция получения провайдера (Phantom)
    const getProvider = () => {
        if ('solana' in window) {
            const provider = window.solana;
            if (provider.isPhantom) return provider;
        }
        return null;
    };

    // ГЛАВНАЯ ФУНКЦИЯ КОННЕКТА
    async function connect() {
        const provider = getProvider();

        if (provider) {
            try {
                connectBtn.disabled = true;
                connectBtn.innerText = "Connecting...";

                // Запрос к Phantom
                const resp = await provider.connect();
                const publicKey = resp.publicKey.toString();

                // Обновляем интерфейс
                statusEl.innerHTML = 'Status: <span class="online">Connected</span>';
                walletInfo.innerText = "Wallet: " + publicKey;
                connectBtn.innerText = "Connected ✅";
                stakingUi.style.display = "block";
                
                console.log("Успешное подключение! Адрес:", publicKey);

            } catch (err) {
                console.error("Пользователь отклонил запрос:", err);
                statusEl.innerHTML = 'Status: <span style="color:#ff4d4d">Rejected</span>';
                connectBtn.disabled = false;
                connectBtn.innerText = "Try Again";
            }
        } else {
            // Если Phantom не найден
            alert("Phantom не найден! Установите расширение.");
            window.open("https://phantom.app/", "_blank");
        }
    }

    // Вешаем событие на кнопку
    connectBtn.addEventListener('click', connect);

    // Слушаем автоматическое отключение
    const provider = getProvider();
    if (provider) {
        provider.on('disconnect', () => {
            statusEl.innerHTML = 'Status: <span style="color:#ff4d4d">Disconnected</span>';
            stakingUi.style.display = "none";
            connectBtn.disabled = false;
            connectBtn.innerText = "Connect Phantom";
        });
    }
});
</script>

</body>
</html>
