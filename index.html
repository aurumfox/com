<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaFox DAO - Professional Edition</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/buffer.min.js"></script>
    <script>window.Buffer = window.buffer.Buffer;</script>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@project-serum/anchor@0.26.0/dist/browser.anchor.min.js"></script>

    <style>
        :root { --gold: #f0b90b; --bg: #0d0d10; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.1); }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Inter', system-ui, sans-serif; margin: 0; line-height: 1.6; }
        
        /* Сетка и Контейнер */
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 30px 0; border-bottom: 1px solid var(--border); margin-bottom: 40px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .card { background: var(--glass); border: 1px solid var(--border); border-radius: 20px; padding: 25px; backdrop-filter: blur(10px); }

        /* Кнопки */
        .btn { background: var(--gold); color: #000; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.2s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(240, 185, 11, 0.3); }
        .btn:disabled { background: #333; color: #777; cursor: not-allowed; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #fff; margin-top: 10px; }

        /* Инпуты */
        input { background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 10px; padding: 12px; color: #fff; width: 100%; box-sizing: border-box; margin: 10px 0; }
        
        /* Статусы */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .online { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        .offline { background: #ff4444; }
        
        h2 { font-size: 1.2rem; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-top: 0; }
        .balance-text { font-size: 0.9rem; color: #888; }
        .val { color: #fff; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1 style="margin:0; font-size: 1.8rem;">ALPHA<span style="color:var(--gold)">FOX</span></h1>
            <div id="connection-status" style="font-size: 12px; margin-top: 5px;">
                <span class="status-dot offline" id="status-dot"></span> <span id="status-text">Disconnected</span>
            </div>
        </div>
        <button id="connect-wallet-btn" class="btn" style="width: auto;">Connect Wallet</button>
    </header>

    <div class="grid">
        <div class="card">
            <h2>Staking Pool</h2>
            <div style="margin-bottom: 20px;">
                <div class="balance-text">Available: <span class="val" id="user-balance">0.00 AFOX</span></div>
                <div class="balance-text">Staked: <span class="val" id="staked-balance">0.00 AFOX</span></div>
            </div>
            <input type="number" id="stake-input" placeholder="Amount to stake">
            <button id="stake-btn" class="btn" disabled>Stake Tokens</button>
            <button id="claim-btn" class="btn btn-outline" disabled>Claim Rewards</button>
        </div>

        <div class="card">
            <h2>Fast Swap</h2>
            <div class="balance-text">Pay: <b>SOL</b></div>
            <input type="number" id="swap-input" placeholder="0.0">
            <div style="text-align: center; margin: 5px 0;">↓</div>
            <div class="balance-text">Receive: <b>AFOX</b></div>
            <input type="text" id="swap-output" placeholder="Result" readonly>
            <button id="swap-btn" class="btn" disabled>Execute Swap</button>
        </div>
    </div>
</div>

<script>
/**
 * ЦЕНТРАЛЬНЫЙ СКРИПТ УПРАВЛЕНИЯ (AlphaFox Unified)
 */

const CONFIG = {
    rpc: "https://api.mainnet-beta.solana.com",
    programId: "ВАШ_PROGRAM_ID_ЗДЕСЬ", // Замени на свой реальный ID
};

let wallet = null;
let connection = null;

// 1. Функция инициализации кошелька
async function initWallet() {
    const btn = document.getElementById('connect-wallet-btn');
    const statusText = document.getElementById('status-text');
    const statusDot = document.getElementById('status-dot');

    try {
        // Проверка Phantom
        const isPhantomInstalled = window.solana && window.solana.isPhantom;
        
        if (!isPhantomInstalled) {
            alert("Please install Phantom Wallet!");
            window.open("https://phantom.app/", "_blank");
            return;
        }

        // Подключение
        const response = await window.solana.connect();
        wallet = response.publicKey.toString();
        connection = new solanaWeb3.Connection(CONFIG.rpc, "confirmed");

        // UI Обновление
        btn.innerText = wallet.substring(0, 4) + "..." + wallet.slice(-4);
        statusText.innerText = "Mainnet-Beta Online";
        statusDot.className = "status-dot online";
        
        // Разблокировка кнопок
        document.querySelectorAll('.btn').forEach(b => b.disabled = false);
        
        console.log("Wallet Connected:", wallet);
        
        // Запуск фоновых обновлений (балансы)
        updateBalances();

    } catch (err) {
        console.error("Connection failed:", err);
    }
}

// 2. Функция обновления балансов
async function updateBalances() {
    if (!wallet) return;
    try {
        const pubKey = new solanaWeb3.PublicKey(wallet);
        const bal = await connection.getBalance(pubKey);
        console.log("SOL Balance:", bal / solanaWeb3.LAMPORTS_PER_SOL);
        // Здесь логика получения баланса токена AFOX через getParsedTokenAccountsByOwner
    } catch (e) {
        console.log("Balance fetch error", e);
    }
}

// 3. Заглушки для твоих функций (вставь сюда свою логику из прошлого кода)
async function handleStake() {
    const amount = document.getElementById('stake-input').value;
    if(!amount) return alert("Enter amount");
    console.log("Staking...", amount);
    // Твой код Anchor здесь
}

async function handleSwap() {
    console.log("Swapping via Jupiter...");
    // Твой код Jupiter API здесь
}

// ПРИВЯЗКА СОБЫТИЙ
document.getElementById('connect-wallet-btn').addEventListener('click', initWallet);
document.getElementById('stake-btn').addEventListener('click', handleStake);
document.getElementById('swap-btn').addEventListener('click', handleSwap);

// Слушатель на случай, если пользователь сменит аккаунт в Phantom
if (window.solana) {
    window.solana.on('accountChanged', () => window.location.reload());
}

</script>
</body>
</html>
